angular.module("easyTable",[]).constant("EasyTableConfig",{limit:10,limits:[5,10,25,100]}).directive("ezTable",["$filter","EasyTableConfig",function(a,b){return{restrict:"A",compile:function(c){var d,e,f,g="<thead><tr>",h='<tr ng-show="showFilters"><th></th>',i=angular.element(c[0].children[0]).find("td");g+='<th><input type="checkbox" ng-model="isToggled" ng-change="toggleAll()"/></th>';for(var j=1;j<i.length-1;j++){if(d=angular.element(i[j]).data("title"),!d)throw new Error('data-title attribute must be specified for column "'+j+'"');e=d.charAt(0).toLowerCase()+d.slice(1),f=angular.element(i[j]).data("field")||e,g+="<th><a ng-click=\"sort('"+f+"')\">"+d+"<span ng-show=\"sortBy == '"+e+'\'" ng-class="{\'caret-up\': asc}" class="caret"></span></a></th>',h+='<th><input class="form-control" ng-model="filters.'+f+'" type="text" ng-change="filter(\''+f+"')\"/></th>"}g+="<th></th></tr>",h+="<th></th></tr>",g+=h+"</thead>",c.prepend(g);var k='<tfoot><tr><td colspan="100%"><input type="checkbox" ng-model="isToggled" ng-change="toggleAll()"/><ul ng-show="pageCount > 1" class="pagination pagination-sm"><li ng-class="{disabled: currentPage == 0}"><a ng-click="prev()">&laquo;</a></li><li ng-class="{active: currentPage == $index}" ng-repeat="page in pages"><a ng-click="setPage($index)">{{ $index + 1 }}</a></li><li ng-class="{disabled: currentPage == (pageCount - 1)}"><a ng-click="next()">&raquo;</a></li></ul><button class="filter-toggle btn btn-sm btn-default pull-right" ng-click="showFilters = !showFilters"><i class="icon-search"></i>Search</button><select class="form-control input-sm table-limit-select pull-right" ng-model="_limit" ng-options="v for v in _limits"></select></td></tfoot>';return c.append(k),c.after('<div ng-show="showBatchActions" class="well"><button class="btn btn-sm btn-default" ng-click="batchEdit()"><i class="icon-pencil"></i>Edit</button><button class="btn btn-sm btn-danger" ng-click="batchDelete()"><i class="icon-remove"></i>Delete</button></div>'),c.addClass("table easy-table table-bordered"),function(c,d,e){c._limit=parseInt(e.limit,10)||b.limit,c._limits=c.$eval(e.limits)||b.limits,c.currentPage=0,c.batchAction="",c.asc=!0,c.filters={},c.setPage=function(a){c.currentPage=a,c.items=c.pages[a]},c.calcPages=function(a){var b=[];if(c.filteredItems&&c.filteredItems.length)b=c.filteredItems;else{for(var d in c.filters)break;d||(b=c.$eval(e.ezTable))}c.pageCount=b.length/c._limit,c.pages=[];for(var f=0;f<c.pageCount;f++)c.pages[f]=b.slice(f*c._limit,f*c._limit+c._limit);c.setPage(a)},c.toggleAll=function(){c.showBatchActions=!c.showBatchActions,angular.forEach(c.items,function(a,b){c.items[b].selected=c.isToggled})},c.prev=function(){c.currentPage>0&&(c.items=c.pages[c.currentPage-1],c.currentPage--,c.isToggled=!1)},c.next=function(){c.currentPage!==c.pages.length-1&&(c.items=c.pages[c.currentPage+1],c.currentPage++,c.isToggled=!1)},c.sort=function(b){c.asc=!c.asc,c.sortBy=b,c[e.ezTable]=a("orderBy")(c[e.ezTable],b,c.asc),c.calcPages(c.currentPage)},c.filter=function(){c.filteredItems=a("filter")(c[e.ezTable],c.filters),c.calcPages(0)},c.$watch("_limit",function(){c.calcPages(c.currentPage)}),c.$watch(e.ezTable,function(a){c.showBatchActions=!1,angular.forEach(a,function(a){return a.selected?(c.showBatchActions=!0,void 0):void 0}),c.calcPages(c.currentPage)},!0),c.calcPages(0)}}}}]);